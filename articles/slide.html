<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with slide • slide</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with slide">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slide</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/slide.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rowwise.html">Row-wise iteration with slide</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DavisVaughan/slide">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with slide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DavisVaughan/slide/blob/master/vignettes/slide.Rmd"><code>vignettes/slide.Rmd</code></a></small>
      <div class="hidden name"><code>slide.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(slide)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lubridate, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>This vignette is meant to serve as an introduction to {slide}. In it, you’ll learn about the three core functions in the package: <code><a href="../reference/slide.html">slide()</a></code>, <code><a href="../reference/slide_index.html">slide_index()</a></code>, and <code><a href="../reference/hop_index.html">hop_index()</a></code>, along with their many variants.</p>
<p>slide is a package for rolling analysis using window functions. “Window functions” is a term that I’ve borrowed from SQL that means that some function is repeatedly applied to different “windows” of your data as you step through it. Typical examples of applications of window functions include rolling averages, cumulative sums, and more complex things such as rolling regressions.</p>
<div id="slide" class="section level2">
<h2 class="hasAnchor">
<a href="#slide" class="anchor"></a>slide()</h2>
<p>To better understand window functions, we’ll turn to our first core function, <code><a href="../reference/slide.html">slide()</a></code>. <code><a href="../reference/slide.html">slide()</a></code> is a bit like <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>. You supply a vector to slide over, <code>.x</code>, and a function to apply to each window, <code>.f</code>. With those two things alone, <code><a href="../reference/slide.html">slide()</a></code> is almost identical to <code>map()</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/slide.html">slide</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span>.x)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<p>On top of this, you can control the size and placement of the window by using the additional arguments to <code><a href="../reference/slide.html">slide()</a></code>. For example, you can ask for a window of size 3 containing “the current element, as well as the 2 before it” like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/slide.html">slide</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; [1] 2 3 4</span></a></code></pre></div>
<p>You’ll notice that the first two elements of the list contain partial or “incomplete” windows. By default, <code><a href="../reference/slide.html">slide()</a></code> assumes that you want to compute on these windows anyways, but if you don’t care about them, you can change the <code>.complete</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/slide.html">slide</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">2</span>, <span class="dt">.complete =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; [1] 2 3 4</span></a></code></pre></div>
<p><code><a href="../reference/slide.html">slide()</a></code> is <em>size stable</em>, so you always get an output that is the same size as your input. Because of that, the partial results have been replaced by the corresponding missing value. For a list, that is <code>NULL</code>.</p>
<p>Sometimes, changing the placement of the window is a critical part of your calculation. For example, you might want a “center alignment” where you have an equal number of values before and after the current element. To accomplish this, you can combine the <code>.before</code> argument with <code>.after</code> to get a centered window. Here we ask for a window of size 3 containing “the current element, as well as 1 element before and 1 element after”. It is “centered” because in position 2 we have a complete window of the current element (2), along with one element before (1) and one after (3).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/slide.html">slide</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">1</span>, <span class="dt">.after =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; [1] 2 3 4</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; [1] 3 4</span></a></code></pre></div>
<p><code><a href="../reference/slide.html">slide()</a></code> can also perform <em>expanding</em> windows. These are the type that allow <em>cumulative</em> operations to work. In prose, an expanding window would be “the current element, along with every element before this one”. To construct this kind of window, you can set <code>.before</code> to <code>Inf</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/slide.html">slide</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; [1] 1 2</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; [1] 1 2 3 4</span></a></code></pre></div>
<p><code><a href="../reference/slide.html">slide()</a></code> is <em>type stable</em>, meaning that it always returns an object of the same type, and the base form of <code><a href="../reference/slide.html">slide()</a></code> always returns a list. So far, this is all that we have used to illustrate how it works, but practically you are more likely to use one of the suffixed forms like <code><a href="../reference/slide.html">slide_dbl()</a></code> or <code><a href="../reference/slide.html">slide_int()</a></code>. For example, you might have a vector of sales data that you want to compute a 3 value moving average on.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">sales_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="../reference/slide.html">slide_dbl</a></span>(sales_vec, mean, <span class="dt">.before =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [1] 2 3 4 4</span></a></code></pre></div>
</div>
<div id="slide_index" class="section level2">
<h2 class="hasAnchor">
<a href="#slide_index" class="anchor"></a>slide_index()</h2>
<p>To make things a bit more interesting, let’s assume that the sales vector from the example above is also tied to some “index”, like a date vector of when the sale actually occurred.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">index_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2019-08-29"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">wday_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="kw"><a href="http://lubridate.tidyverse.org/reference/day.html">wday</a></span>(index_vec, <span class="dt">label =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">company &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="dt">sales =</span> sales_vec,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="dt">index =</span> index_vec,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="dt">wday =</span> wday_vec</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">company</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;   sales index      wday </span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 1     2 2019-08-29 Thu  </span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 2     4 2019-08-30 Fri  </span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; 3     6 2019-09-03 Tue  </span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; 4     2 2019-09-04 Wed</span></a></code></pre></div>
<p>This index is increasing but irregular, meaning that we “jumped” from Friday to Tuesday because there were no sales between those dates. For the purpose of this example, let’s assume that this is an online company where it is perfectly reasonable that you <em>could</em> have sales on both Saturday and Sunday (If your use case requires that you “skip over” weekends and even holidays, you might like <a href="https://github.com/DavisVaughan/almanac">{almanac}</a>).</p>
<p>A reasonable business question to ask would be to compute a <em>3 day</em> moving average. Is this different from the 3 value moving average we computed before? Here is the expected result, side by side with the 3 value one computed using <code><a href="../reference/slide.html">slide_dbl()</a></code> from before.</p>
<pre><code>#&gt; # A tibble: 4 x 5
#&gt;   sales index      wday  roll_val roll_day
#&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1     2 2019-08-29 Thu          2        2
#&gt; 2     4 2019-08-30 Fri          3        3
#&gt; 3     6 2019-09-03 Tue          4        6
#&gt; 4     2 2019-09-04 Wed          4        4</code></pre>
<p>The difference shows up in the third row, when computing the 3 day moving average looking back from Tuesday. To understand why they are different, consider what <code><a href="../reference/slide.html">slide_dbl()</a></code> does. It uses the <code>sales</code> column and looks at the “current row, along with two rows before it” to compute the result. When you are on row 3, this would select rows 1-3 giving the date range of <code>[Thu, Tue]</code>, which isn’t 3 days. The correct answer would have been to look back 2 days from Tuesday, not 2 rows from row 3. This would have given us the date window of <code>[Sun, Tue]</code>, and only values in that range should be included in the moving average calculation for row 3. The only row in that range is row 3, so we should just be averaging the single value of <code>6</code> to get our result.</p>
<p><code><a href="../reference/slide.html">slide_dbl()</a></code> doesn’t give us what we want because it is <em>unaware of the index column</em>. It just looks back a set number of values. What we need is a function that “knows” about the <code>index</code> and can adjust accordingly. For that, you can use <code><a href="../reference/slide_index.html">slide_index(.x, .i, .f, ...)</a></code> which has a <code>.i</code> argument to pass an index vector through.</p>
<p>To understand how <code><a href="../reference/slide_index.html">slide_index()</a></code> works, take a look at the following comparison to <code><a href="../reference/slide.html">slide()</a></code>. For illustration, the current window of the weekday vector is printed out. Notice that in position 3, <code><a href="../reference/slide.html">slide()</a></code> gives us the “wrong” result of Thursday, Friday and Tuesday, because it just looks back 2 values.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">wday_vec</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; [1] "Thu" "Fri" "Tue" "Wed"</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw"><a href="../reference/slide.html">slide</a></span>(wday_vec, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; [1] "Thu"</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; [1] "Thu" "Fri"</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; [1] "Thu" "Fri" "Tue"</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; [1] "Fri" "Tue" "Wed"</span></a></code></pre></div>
<p>On the other hand, <code><a href="../reference/slide_index.html">slide_index()</a></code> can be “aware” of the irregular index vector. By passing it through as <code>.i</code>, and by swapping a look back period of 2 for the lubridate object of <code><a href="http://lubridate.tidyverse.org/reference/period.html">days(2)</a></code>, the start of the range is computed as <code>.i - days(2)</code>, which correctly computes a date window of <code>[Sun, Tue]</code> for the third element, so that we only capture Tuesday in the window.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/slide_index.html">slide_index</a></span>(wday_vec, index_vec, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; [1] "Thu"</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; [1] "Thu" "Fri"</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; [1] "Tue"</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; [1] "Tue" "Wed"</span></a></code></pre></div>
<p>Knowing this, we can swap out <code><a href="../reference/slide.html">slide_dbl()</a></code> for <code><a href="../reference/slide_index.html">slide_index_dbl()</a></code> to see how to correctly compute our 3 day rolling average.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  company, </a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">roll_val =</span> <span class="kw"><a href="../reference/slide.html">slide_dbl</a></span>(sales, mean, <span class="dt">.before =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">roll_day =</span> <span class="kw"><a href="../reference/slide_index.html">slide_index_dbl</a></span>(sales, index, mean, <span class="dt">.before =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; # A tibble: 4 x 5</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt;   sales index      wday  roll_val roll_day</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; 1     2 2019-08-29 Thu          2        2</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; 2     4 2019-08-30 Fri          3        3</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; 3     6 2019-09-03 Tue          4        6</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; 4     2 2019-09-04 Wed          4        4</span></a></code></pre></div>
</div>
<div id="hop_index" class="section level2">
<h2 class="hasAnchor">
<a href="#hop_index" class="anchor"></a>hop_index()</h2>
<p><code><a href="../reference/hop_index.html">hop_index()</a></code> is a lower level function that you can think of as powering <code><a href="../reference/slide_index.html">slide_index()</a></code>. It has the <code>.i</code> argument for the index, but in place of <code>.before</code> and <code>.after</code> are <code>.starts</code> and <code>.stops</code>, vectors of the same type as <code>.i</code> that allow fine tuned control over the exact windows that are used.</p>
<p>As a first example, let’s look at how <code><a href="../reference/hop_index.html">hop_index()</a></code> can be equivalent to <code><a href="../reference/slide_index.html">slide_index()</a></code>. Previously we had computed a <code>roll_day</code> column:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">company <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="dt">roll_day =</span> <span class="kw"><a href="../reference/slide_index.html">slide_index_dbl</a></span>(sales, index, mean, <span class="dt">.before =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; # A tibble: 4 x 4</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt;   sales index      wday  roll_day</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; 1     2 2019-08-29 Thu          2</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; 2     4 2019-08-30 Fri          3</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; 3     6 2019-09-03 Tue          6</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; 4     2 2019-09-04 Wed          4</span></a></code></pre></div>
<p>This would be equivalent to “manually” computing the <code>.starts</code> by subtracting 2 days from <code>index</code>, and “manually” computing the <code>.stops</code>, which is just the <code>index</code> itself since we aren’t looking forward any amount of time.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">company <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="dt">starts =</span> index <span class="op">-</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    <span class="dt">stops =</span> index,</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    <span class="dt">roll_day =</span> <span class="kw"><a href="../reference/hop_index.html">hop_index_dbl</a></span>(sales, index, starts, stops, mean)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; # A tibble: 4 x 6</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt;   sales index      wday  starts     stops      roll_day</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt; &lt;date&gt;     &lt;date&gt;        &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; 1     2 2019-08-29 Thu   2019-08-27 2019-08-29        2</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; 2     4 2019-08-30 Fri   2019-08-28 2019-08-30        3</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; 3     6 2019-09-03 Tue   2019-09-01 2019-09-03        6</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; 4     2 2019-09-04 Wed   2019-09-02 2019-09-04        4</span></a></code></pre></div>
<p>The rules that govern the output of <code><a href="../reference/hop_index.html">hop_index()</a></code> are slightly different from <code><a href="../reference/slide.html">slide()</a></code> and <code><a href="../reference/slide_index.html">slide_index()</a></code>. It is still type stable as you’d expect, but the <em>size</em> of the output is different than the other two. Where <code><a href="../reference/slide.html">slide()</a></code> returns an output that is the same size as <code>.x</code>, <code><a href="../reference/hop_index.html">hop_index()</a></code> returns an output that is the same size as <code>.starts</code> and <code>.stops</code>. This is actually <em>extremely</em> useful in some scenarios, allowing you to either decrease or increase the size of the output to ranges that you actually care about. The examples below showcase both of the usages.</p>
<div id="decreasing-the-size" class="section level3">
<h3 class="hasAnchor">
<a href="#decreasing-the-size" class="anchor"></a>Decreasing the size</h3>
<p>Imagine you have another set of some irregular daily sales data, spanning 3 months.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">daily_sales &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="dt">sales =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">35</span>, <span class="dv">77</span>, <span class="dv">14</span>, <span class="dv">22</span>),</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="dt">index =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2019-01-25"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">35</span>, <span class="dv">42</span>, <span class="dv">45</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">daily_sales</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; # A tibble: 9 x 2</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt;   sales index     </span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">#&gt;   &lt;dbl&gt; &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; 1    10 2019-01-25</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; 2    20 2019-01-26</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt; 3    50 2019-01-27</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; 4    12 2019-01-28</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt; 5    14 2019-02-04</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt; 6    35 2019-02-14</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt; 7    77 2019-03-01</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt; 8    14 2019-03-08</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt; 9    22 2019-03-11</span></a></code></pre></div>
<p>You are tasked with computing rolling two month total sales numbers. You should end up with two values, one for the range of <code>[2019-01-01, 2019-02-28]</code> and one for <code>[2019-02-01, 2019-03-31]</code>. Note that this is a bit hard to accomplish using dplyr alone because these ranges overlap, so we can’t construct a column to group on and then summarize it.</p>
<p>Using <code><a href="../reference/hop_index.html">hop_index()</a></code>, we can manually construct these ranges and pass them as the <code>.starts</code> and <code>.stops</code>, and we will only get 2 values back. To be slightly more general, rather than hard coding these dates I’ll generate the ranges programmatically.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">jan_first &lt;-<span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(daily_sales<span class="op">$</span>index), <span class="st">"1 month"</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">apr_first &lt;-<span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/round_date.html">ceiling_date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(daily_sales<span class="op">$</span>index), <span class="st">"1 month"</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">dates &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(jan_first, apr_first, <span class="st">"1 month"</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">results &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  <span class="dt">starts =</span> dates[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  <span class="dt">stops =</span> dates[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10"></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">results</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt;   starts     stops     </span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt;   &lt;date&gt;     &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; 1 2019-01-01 2019-02-28</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; 2 2019-02-01 2019-03-31</span></a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    <span class="dt">total_sales =</span> <span class="kw"><a href="../reference/hop_index.html">hop_index_dbl</a></span>(</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">      <span class="dt">.x =</span> daily_sales<span class="op">$</span>sales, </a>
<a class="sourceLine" id="cb17-5" data-line-number="5">      <span class="dt">.i =</span> daily_sales<span class="op">$</span>index,</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">      <span class="dt">.starts =</span> starts,</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">      <span class="dt">.stops =</span> stops,</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">      <span class="dt">.f =</span> sum</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">  ) </a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; # A tibble: 2 x 3</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;   starts     stops      total_sales</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt;   &lt;date&gt;     &lt;date&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt; 1 2019-01-01 2019-02-28         141</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; 2 2019-02-01 2019-03-31         162</span></a></code></pre></div>
</div>
<div id="increasing-the-size" class="section level3">
<h3 class="hasAnchor">
<a href="#increasing-the-size" class="anchor"></a>Increasing the size</h3>
<p>This last example is inspired by a real internal question an RStudio employee had.</p>
<p>Imagine you have a set of customers, each identifiable by an <code>id</code>, and each customer has a contract with you that expires on a particular <code>date</code>. The day is currently <code>2019-09-27</code>, and your boss gives you the following task:</p>
<p>“For every day from today until our last expiration, I want a count of how many customers are currently active.”</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">today &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2019-09-27"</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">customers &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  <span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  <span class="dt">date =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2019-12-23"</span>, <span class="st">"2020-01-01"</span>, <span class="st">"2021-04-02"</span>))</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">customers</a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt;      id date      </span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt;   &lt;int&gt; &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; 1     1 2019-12-23</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt; 2     2 2020-01-01</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; 3     3 2021-04-02</span></a></code></pre></div>
<p>With the above data set, we’d have results like:</p>
<ul>
<li>3 active on <code>2019-09-27</code>
</li>
<li>3 active on <code>2019-09-28</code>
</li>
<li>…</li>
<li>2 active on <code>2019-12-24</code> (id 1 expired)</li>
<li>…</li>
<li>1 active on <code>2021-04-02</code> (last day)</li>
</ul>
<p>There are multiple ways to solve this problem, and I felt that <code><a href="../reference/hop_index.html">hop_index()</a></code> provided a pretty nice solution! The general idea is as follows:</p>
<p>The result should be a tibble with a date column containing every day between now and the last expiration, and another column for the count of active customers. This date column represents our <code>.starts</code>, and the <code>.stops</code> is always the last expiration date. So we’ll construct the date column first, and then pass that on to <code><a href="../reference/hop_index.html">hop_index()</a></code> to compute our result, counting all of the active customer <code>id</code>s on any particular day by just taking the <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> of the current window.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">last_expiration &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(customers<span class="op">$</span>date)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co"># We don't need a `.stops` column because it is always </span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co"># `last_expiration` and `hop_index_int()` will recycle it for us</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">result &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  <span class="dt">current_date =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(today, last_expiration, <span class="dt">by =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">result</a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt; # A tibble: 554 x 1</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt;    current_date</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt;    &lt;date&gt;      </span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt;  1 2019-09-27  </span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt;  2 2019-09-28  </span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt;  3 2019-09-29  </span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt;  4 2019-09-30  </span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt;  5 2019-10-01  </span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt;  6 2019-10-02  </span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">#&gt;  7 2019-10-03  </span></a>
<a class="sourceLine" id="cb19-20" data-line-number="20"><span class="co">#&gt;  8 2019-10-04  </span></a>
<a class="sourceLine" id="cb19-21" data-line-number="21"><span class="co">#&gt;  9 2019-10-05  </span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22"><span class="co">#&gt; 10 2019-10-06  </span></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="co">#&gt; # … with 544 more rows</span></a>
<a class="sourceLine" id="cb19-24" data-line-number="24"></a>
<a class="sourceLine" id="cb19-25" data-line-number="25">result &lt;-<span class="st"> </span>result <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-26" data-line-number="26"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb19-27" data-line-number="27">    <span class="dt">active =</span> <span class="kw"><a href="../reference/hop_index.html">hop_index_int</a></span>(</a>
<a class="sourceLine" id="cb19-28" data-line-number="28">      <span class="dt">.x =</span> customers<span class="op">$</span>id, </a>
<a class="sourceLine" id="cb19-29" data-line-number="29">      <span class="dt">.i =</span> customers<span class="op">$</span>date,</a>
<a class="sourceLine" id="cb19-30" data-line-number="30">      <span class="dt">.starts =</span> current_date,</a>
<a class="sourceLine" id="cb19-31" data-line-number="31">      <span class="dt">.stops =</span> last_expiration,</a>
<a class="sourceLine" id="cb19-32" data-line-number="32">      <span class="dt">.f =</span> length</a>
<a class="sourceLine" id="cb19-33" data-line-number="33">    )</a>
<a class="sourceLine" id="cb19-34" data-line-number="34">  )</a>
<a class="sourceLine" id="cb19-35" data-line-number="35"></a>
<a class="sourceLine" id="cb19-36" data-line-number="36">result</a>
<a class="sourceLine" id="cb19-37" data-line-number="37"><span class="co">#&gt; # A tibble: 554 x 2</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38"><span class="co">#&gt;    current_date active</span></a>
<a class="sourceLine" id="cb19-39" data-line-number="39"><span class="co">#&gt;    &lt;date&gt;        &lt;int&gt;</span></a>
<a class="sourceLine" id="cb19-40" data-line-number="40"><span class="co">#&gt;  1 2019-09-27        3</span></a>
<a class="sourceLine" id="cb19-41" data-line-number="41"><span class="co">#&gt;  2 2019-09-28        3</span></a>
<a class="sourceLine" id="cb19-42" data-line-number="42"><span class="co">#&gt;  3 2019-09-29        3</span></a>
<a class="sourceLine" id="cb19-43" data-line-number="43"><span class="co">#&gt;  4 2019-09-30        3</span></a>
<a class="sourceLine" id="cb19-44" data-line-number="44"><span class="co">#&gt;  5 2019-10-01        3</span></a>
<a class="sourceLine" id="cb19-45" data-line-number="45"><span class="co">#&gt;  6 2019-10-02        3</span></a>
<a class="sourceLine" id="cb19-46" data-line-number="46"><span class="co">#&gt;  7 2019-10-03        3</span></a>
<a class="sourceLine" id="cb19-47" data-line-number="47"><span class="co">#&gt;  8 2019-10-04        3</span></a>
<a class="sourceLine" id="cb19-48" data-line-number="48"><span class="co">#&gt;  9 2019-10-05        3</span></a>
<a class="sourceLine" id="cb19-49" data-line-number="49"><span class="co">#&gt; 10 2019-10-06        3</span></a>
<a class="sourceLine" id="cb19-50" data-line-number="50"><span class="co">#&gt; # … with 544 more rows</span></a></code></pre></div>
<p>We can filter down to a range of interest to ensure that we computed the correct number of active customers as they expire.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">result <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">    current_date <span class="op">&gt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(customers<span class="op">$</span>date) <span class="op">-</span><span class="st"> </span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    current_date <span class="op">&lt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(customers<span class="op">$</span>date) <span class="op">+</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt; # A tibble: 7 x 2</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;   current_date active</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;   &lt;date&gt;        &lt;int&gt;</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt; 1 2019-12-20        3</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt; 2 2019-12-21        3</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt; 3 2019-12-22        3</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt; 4 2019-12-23        3</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt; 5 2019-12-24        2</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt; 6 2019-12-25        2</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; 7 2019-12-26        2</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#slide">slide()</a></li>
      <li><a href="#slide_index">slide_index()</a></li>
      <li><a href="#hop_index">hop_index()</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
