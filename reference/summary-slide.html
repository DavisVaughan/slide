<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Specialized sliding functions — summary-slide • slider</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Specialized sliding functions — summary-slide" />
<meta property="og:description" content="These functions are specialized variants of the most common ways that
slide() is generally used. Notably, slide_sum() can be used for
rolling sums, and slide_mean() can be used for rolling averages.
These specialized variants are much faster and more memory efficient
than using an otherwise equivalent call constructed with slide_dbl()
or slide_lgl(), especially with a very wide window." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slider</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/slider.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/rowwise.html">Row-wise iteration with slider</a>
    </li>
    <li>
      <a href="../articles/tsibble.html">Converting from tsibble</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/DavisVaughan/slider/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Specialized sliding functions</h1>
    <small class="dont-index">Source: <a href='https://github.com/DavisVaughan/slider/blob/master/R/summary-slide.R'><code>R/summary-slide.R</code></a></small>
    <div class="hidden name"><code>summary-slide.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions are specialized variants of the most common ways that
<code><a href='slide.html'>slide()</a></code> is generally used. Notably, <code>slide_sum()</code> can be used for
rolling sums, and <code>slide_mean()</code> can be used for rolling averages.</p>
<p>These specialized variants are <em>much</em> faster and more memory efficient
than using an otherwise equivalent call constructed with <code><a href='slide.html'>slide_dbl()</a></code>
or <code><a href='slide.html'>slide_lgl()</a></code>, especially with a very wide window.</p>
    </div>

    <pre class="usage"><span class='fu'>slide_sum</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>slide_prod</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>slide_mean</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>slide_min</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>slide_max</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>slide_all</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>slide_any</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>...</span>,
  before <span class='op'>=</span> <span class='fl'>0L</span>,
  after <span class='op'>=</span> <span class='fl'>0L</span>,
  step <span class='op'>=</span> <span class='fl'>1L</span>,
  complete <span class='op'>=</span> <span class='cn'>FALSE</span>,
  na_rm <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>[vector]</code></p>
<p>A vector to compute the sliding function on.</p><ul>
<li><p>For sliding sum, mean, prod, min, and max, <code>x</code> will be cast to a double
vector with <code><a href='https://vctrs.r-lib.org/reference/vec_cast.html'>vctrs::vec_cast()</a></code>.</p></li>
<li><p>For sliding any and all, <code>x</code> will be cast to a logical vector with
<code><a href='https://vctrs.r-lib.org/reference/vec_cast.html'>vctrs::vec_cast()</a></code>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>These dots are for future extensions and must be empty.</p></td>
    </tr>
    <tr>
      <th>before</th>
      <td><p><code>[integer(1) / Inf]</code></p>
<p>The number of values before or after the current element to
include in the sliding window. Set to <code>Inf</code> to select all elements
before or after the current element. Negative values are allowed, which
allows you to "look forward" from the current element if used as the
<code>.before</code> value, or "look backwards" if used as <code>.after</code>.</p></td>
    </tr>
    <tr>
      <th>after</th>
      <td><p><code>[integer(1) / Inf]</code></p>
<p>The number of values before or after the current element to
include in the sliding window. Set to <code>Inf</code> to select all elements
before or after the current element. Negative values are allowed, which
allows you to "look forward" from the current element if used as the
<code>.before</code> value, or "look backwards" if used as <code>.after</code>.</p></td>
    </tr>
    <tr>
      <th>step</th>
      <td><p><code>[positive integer(1)]</code></p>
<p>The number of elements to shift the window forward between function calls.</p></td>
    </tr>
    <tr>
      <th>complete</th>
      <td><p><code>[logical(1)]</code></p>
<p>Should the function be evaluated on complete windows only? If <code>FALSE</code>,
the default, then partial computations will be allowed.</p></td>
    </tr>
    <tr>
      <th>na_rm</th>
      <td><p><code>[logical(1)]</code></p>
<p>Should missing values be removed from the computation?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A vector the same size as <code>x</code> containing the result of applying the
summary function over the sliding windows.</p><ul>
<li><p>For sliding sum, mean, prod, min, and max, a double vector will be
returned.</p></li>
<li><p>For sliding any and all, a logical vector will be returned.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note that these functions are <em>not</em> generic and do not respect method
dispatch of the corresponding summary function (i.e. <code><a href='https://rdrr.io/r/base/sum.html'>base::sum()</a></code>,
<code><a href='https://rdrr.io/r/base/mean.html'>base::mean()</a></code>). Input will always be cast to a double or logical vector
using <code><a href='https://vctrs.r-lib.org/reference/vec_cast.html'>vctrs::vec_cast()</a></code>, and an internal method for computing the summary
function will be used.</p>
<p>Due to the structure of segment trees, <code>slide_mean()</code> does not perform the
same "two pass" mean that <code><a href='https://rdrr.io/r/base/mean.html'>mean()</a></code> does (the intention of the second pass is
to perform a floating point error correction). Because of this, there may be
small differences between <code>slide_mean(x)</code> and <code><a href='slide.html'>slide_dbl(x, mean)</a></code> in some
cases.</p>
    <h2 class="hasAnchor" id="implementation"><a class="anchor" href="#implementation"></a>Implementation</h2>

    


<p>These variants are implemented using a data structure known as a
<em>segment tree</em>, which allows for extremely fast repeated range queries
without loss of precision.</p>
<p>One alternative to segment trees is to directly recompute the summary
function on each full window. This is what is done by using, for example,
<code><a href='slide.html'>slide_dbl(x, sum)</a></code>. This is extremely slow with large window sizes and
wastes a lot of effort recomputing nearly the same information on each
window. It can be made slightly faster by moving the sum to C to avoid
intermediate allocations, but it still fairly slow.</p>
<p>A second alternative is to use an <em>online</em> algorithm, which uses information
from the previous window to compute the next window. These are extremely
fast, only requiring a single pass through the data, but often suffer from
numerical instability issues.</p>
<p>Segment trees are an attempt to reconcile the performance issues of the
direct approach with the numerical issues of the online approach. The
performance of segment trees isn't quite as fast as online algorithms, but is
close enough that it should be usable on most large data sets without any
issues. Unlike online algorithms, segment trees don't suffer from any
extra numerical instability issues.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Leis, Kundhikanjana, Kemper, and Neumann (2015). "Efficient Processing of
Window Functions in Analytical SQL Queries".
https://dl.acm.org/doi/10.14778/2794367.2794375</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='summary-index.html'>slide_index_sum()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>3</span>, <span class='fl'>2</span>, <span class='fl'>6</span>, <span class='fl'>10</span><span class='op'>)</span>

<span class='co'># `slide_sum()` can be used for rolling sums.</span>
<span class='co'># The following are equivalent, but `slide_sum()` is much faster.</span>
<span class='fu'>slide_sum</span><span class='op'>(</span><span class='va'>x</span>, before <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1]  1  6  9 10 11 18</div><div class='input'><span class='fu'><a href='slide.html'>slide_dbl</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>sum</span>, .before <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1]  1  6  9 10 11 18</div><div class='input'>
<span class='co'># `slide_mean()` can be used for rolling averages</span>
<span class='fu'>slide_mean</span><span class='op'>(</span><span class='va'>x</span>, before <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 1.000000 3.000000 3.000000 3.333333 3.666667 6.000000</div><div class='input'>
<span class='co'># Only evaluate the sum on complete windows</span>
<span class='fu'>slide_sum</span><span class='op'>(</span><span class='va'>x</span>, before <span class='op'>=</span> <span class='fl'>2</span>, after <span class='op'>=</span> <span class='fl'>1</span>, complete <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] NA NA 11 16 21 NA</div><div class='input'>
<span class='co'># Skip every other calculation</span>
<span class='fu'>slide_sum</span><span class='op'>(</span><span class='va'>x</span>, before <span class='op'>=</span> <span class='fl'>2</span>, step <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1]  1 NA  9 NA 11 NA</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


